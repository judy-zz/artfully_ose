- in_section :transactions
- content_for :header do
  %h1 Contributions
  %h2 Donations & Grants

.context
  %ul.context-buttons
    %li= button_to "Record Contribution", new_contribution_path, :method => :get

  %h3 Range
  #donations-search
    %ul.kv
      = form_tag contributions_path, :method => :get do
        %li
          .key= label_tag :start_date
          .value= text_field_tag :start,"#{l @search.start, :format => :date_for_input}", :readonly => true, :class => 'datepicker'
        %li
          .key= label_tag :end_date
          .value= text_field_tag :stop, "#{l @search.stop, :format => :date_for_input}", :readonly => true, :class => 'datepicker'
        = submit_tag "Search"


.document
  %h3 Donations
  - unless @search.results.empty?
    %h4= "From #{l @search.start} to #{l @search.stop}"
    #donations
      %table.standalone.zebra
        %thead
          %tr
            %th Item
            %th Timestamp
            %th Person
            %th Amount
            %th Order
        %tbody
          - @search.results.each do |order|
            - order.items.select(&:donation?).each do |item|
              %tr
                %td= item.id
                %td= l order.timestamp
                %td= link_to "#{order.person.last_name}, #{order.person.first_name}", person_path(order.person)
                %td= number_as_cents item.price
                %td= link_to "#{order.id}", order_path(order)
      = will_paginate(@search.results)
  - else
    %h4= "No donations found between #{l @search.start} and #{l @search.stop}"