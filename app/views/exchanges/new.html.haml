- in_section :people
- content_for :header do
  %h1 Exchanging Tickets

.drilldown
  %h3 1. Choose an event
  %ul#event-drilldown
    - @events.each do |event|
      %li= link_to event.name, params.merge({:event_id => event.id}), :title => 'event-name'

.drilldown
  - unless @shows.nil?
    %h3 2. Choose a show
    - if @shows.empty?
      %p Sorry, there are no upcoming shows with tickets available
    - else
      %ul#show-drilldown
        - @shows.each do |show|
          %li= link_to l(show.datetime_local_to_event, :format => :short), params.merge({:show_id => show.id}), :title => 'show-datetime'

.drilldown
  - unless @show.nil?
    %h3 3. Choose a section
    %ul#section-drilldown
      - @show.chart.sections.each do |section|
        %li= link_to (truncate(section.name, :length => 20, :separator => ' ', :omission => '...') + ' ' + number_to_currency(section.price / 100)), params.merge({:section_id => section.id}), :title => 'section-name'

.drilldown.final
  - unless @section.nil?
    %h3 4. Select tickets
    - if @tickets.empty?
      %p Sorry, there are no tickets available in that section.
    - else
      %p="You are exchanging #{pluralize(params[:items].length, 'ticket')}, please select #{pluralize(params[:items].length, 'ticket')} below"
      = form_tag '/exchanges' do
        = hidden_field_tag :order_id, params[:order_id]
        - params[:items].each do |item_id|
          = hidden_field_tag "items[]", item_id
        %ul#ticket-drilldown
          - @tickets.each do |ticket|
            %li
              .label-and-element
                = check_box_tag "tickets[]", ticket.id, false, :id => "ticket_#{ticket.id}"
                = label_tag "ticket_#{ticket.id}", "#{ticket.section.name}, #{number_as_cents ticket.price}"
        %p
          = submit_tag "Exchange these tickets", :class => "btn"
