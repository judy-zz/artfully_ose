- in_section :transactions
- content_for :header do
  %h1 Orders

.order-search
  = form_tag orders_path, {:method => :get, :class => 'super-search form-search'} do
    = text_field_tag :search, "", :placeholder => "Enter an order number..."
    = submit_tag "Search", :class => "btn"

#orders-table
  - if !params["search"].nil? && @results.empty?
    %p No orders matched your search.
  - elsif @results.nil?
    -#Case needed for Cucumber testing
  - else
    -if params["search"].nil?
      %h3 Recent Orders
    -else
      %h3 Search Results

    #orders
      %table.standalone.zebra.table
        %thead
          %tr
            %th ID
            %th Person
            %th Order Date
            %th Event
            %th Show
            %th Details
            %th Total
        %tbody
          -@results.each do |order|
            %tr
              %td=link_to "#{order.id}", order_path(order)
              %td= link_to_person order.person
              -unless order.created_at.nil?
                %td= l order.created_at_local_to_organization
              -else
                %td
              -if order.items.size > 0 and "Ticket" == order.items.first.product_type
                -ticket = Ticket.find(order.items.first.product_id)
                %td=link_to "#{ticket.event.name}", event_path(ticket.event.id)
              -else
                %td
              -if order.items.size > 0 and "Ticket" == order.items.first.product_type
                -ticket = Ticket.find(order.items.first.product_id)
                %td=link_to "#{l ticket.show.datetime_local_to_event, :format=>:short}", event_show_path(ticket.event.id, ticket.show.id)
              -else
                %td
              -details = []
              -details << pluralize(order.num_tickets, "ticket") unless order.num_tickets <= 0
              -details << " #{number_as_cents(order.sum_donations)} donation" unless order.sum_donations <= 0.0
              %td= details.compact.to_sentence
              %td= number_as_cents order.total

      =will_paginate @results

