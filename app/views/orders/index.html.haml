- in_section :transactions
- content_for :header do
  %h1 Orders & Donations
  %h2 Find and manage orders and donations

.spread
  %form
    = form_tag orders_path, :method => :get do
      %ul
        %li
          .full.paired.element
            = text_field_tag :search, "", :placeholder => "Enter an order number..."
            = submit_tag "Search"

.spread
  - if !params["search"].nil? && @results.empty?
    %p No orders matched your search.
  - elsif @results.nil?
    -#Case needed for Cucumber testing
  - else
    -if params["search"].nil?
      %h3 Recent Orders
    -else
      %h3 Search Results

    #orders
      %table.standalone.zebra
        %thead
          %tr
            %th ID
            %th Person
            %th Date
            %th Event
            %th Detail
        %tbody
          -@results.each do |order|
            %tr
              %td=link_to "#{order.id}", order_path(order)
              %td= link_to_person order.person
              -unless order.created_at.nil?
                %td= l order.created_at
              -else
                %td
              -if order.items.size > 0 and "Ticket" == order.items.first.product_type
                -ticket = Ticket.find(order.items.first.product_id)
                %td=link_to "#{ticket.event.name}", event_path(ticket.event.id)
              -else
                %td
              -details = []
              -details << pluralize(order.num_tickets, "ticket") unless order.num_tickets <= 0
              -details << " #{number_as_cents(order.sum_donations)} donation" unless order.sum_donations <= 0.0
              %td= details.compact.to_sentence

      =will_paginate @results

