- in_section :transactions
- content_for :header do
  %h1 Sales

#donations-search
  %ul.kv
    = form_tag sales_orders_path, :method => :get, :class => 'form-inline' do
      = text_field_tag :start,"#{l @search.start, :format => :date_for_input}", :readonly => true, :class => 'datepicker input-small'
      = text_field_tag :stop, "#{l @search.stop, :format => :date_for_input}", :readonly => true, :class => 'datepicker input-small'
      = submit_tag "Search", :class => "btn"

- unless @search.results.empty?
  #tickets
    %table.standalone.zebra.table
      %thead
        %tr
          %th Order
          %th Time
          %th Person
          %th Method
          %th Event and Show
          %th Amount
      %tbody
        - @search.results.each do |order|
          - order.items.select(&:ticket?).each_with_index do |item, index|
            %tr
              - if index == 0
                - rowspan = order.items.select(&:ticket?).size
                %td{:rowspan => rowspan}= link_to order.id, order_path(order.id)
                %td{:rowspan => rowspan}= l(order.created_at_local_to_organization, :format => :short)
                %td{:rowspan => rowspan}= link_to_person(order.person)
                %td{:rowspan => rowspan}= (order.payment_method || "")
              %td 
                ="#{item.product.event.name}"
                %br
                ="#{l item.product.show.datetime_local_to_event}"
              %td= number_as_cents item.price
    = will_paginate(@search.results)
- else
  %h4= "No sales found between #{l @search.start} and #{l @search.stop}"
