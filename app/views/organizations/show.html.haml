- in_section :dashboard
- content_for :header do
  %h1=@organization.name

.context
  %h3 Details
  %ul.kv
    -unless @organization.legal_organization_name.blank?
      %li
        .key Legal Name
        .value= @organization.legal_organization_name
    -unless @organization.ein.blank?
      %li
        .key EIN
        .value= @organization.ein
    %li
      .key Time Zone
      .value= @organization.time_zone

  - unless @organization.connected?
    %h3 Connect to Fractured Atlas
    %h2 This organization has not been connected to a Fractured Atlas member.
    = render :partial => 'connection_form', :locals => { :organization => @organization, :fa_user => @fa_user }
  - else
    %h2 This organization has been connected to a Fractured Atlas membership.

.document
  %h3 Kits
  %p Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin vehicula nisi eget lacus gravida at iaculis mi luctus. Vestibulum accumsan est eget lacus accumsan a condimentum leo volutpat. In congue rhoncus neque, ut tincidunt quam sagittis eget. In hac habitasse platea dictumst. Quisque non imperdiet magna.
  %p= "Only the owner of this organization (#{current_user.current_organization.owner.email}) can make changes to kits." unless can? :manage, current_user.current_organization
  #kits
    %table.standalone
      %thead
        %tr
          %th Name
          -if can? :manage, current_user.current_organization
            %th Actions
          -else
            %th State
      %tbody
        - @kits.each do |kit|
          %tr
            %td= kit.type.underscore.titleize
            -if can? :manage, current_user.current_organization
              - if kit.new?
                - if kit.has_alternatives?
                  %td= link_to "Activate #{kit.type.underscore.titleize}", alternatives_kits_path(:type => kit.type.underscore)
                - else
                  %td= link_to "Activate #{kit.type.underscore.titleize}", new_kit_path(:type => kit.type.underscore)
              - elsif kit.cancelled?
                %td= link_to "Reactivate #{kit.type.underscore.titleize}", kit_path(kit), :method => :put
              - else
                %td= kit.state.titleize
            -else
              - if kit.new?
                %td= "Not active"
              - elsif kit.cancelled?
                %td= "Cancelled"
              - else
                %td= kit.state.titleize
  %h3 Members (#{@organization.users.size})
  %ul.detailed-list#memberships
    - @organization.users.each do |user|
      %li
        %h4= "#{user.email}"
        %ul.details
          -if user == current_user.current_organization.owner
            %li Organization administrator
          -elsif can? :manage, current_user.current_organization
            %li= link_to "Remove", organization_membership_path(@organization, user.memberships.first), :method => :delete
  -if can? :manage, current_user.current_organization
    %h3 Add User
    = form_tag organization_memberships_path(@organization.id), :action => "create" do
      %ul
        %li
          .label=   label_tag :user_email, "Email"
          .element= text_field_tag :user_email
        %li
          = submit_tag "Add"